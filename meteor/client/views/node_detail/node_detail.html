<!--
~ Copyright 2015 Concept
~
~ Licensed under the Apache License, Version 2.0 (the "License");
~ you may not use this file except in compliance with the License.
~ You may obtain a copy of the License at
~
~ http://www.apache.org/licenses/LICENSE-2.0
~
~ Unless required by applicable law or agreed to in writing, software
~ distributed under the License is distributed on an "AS IS" BASIS,
~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
~ See the License for the specific language governing permissions and
~ limitations under the License.
-->

<!--
Edit information about a reference.
-->
<template name="NodeDetail">
  {{#if node.title}}<h3 style="margin-top:0;">{{node.title}}</h3>{{/if}}
  {{#if node.description}}<p style="margin-bottom:20px;"><em>{{{convertLineBreaks node.description}}}</em></p>{{/if}}
    {{#if $.Session.equals "showNodeForm" true}}
      <div class="panel panel-default">
        <!-- Default panel contents -->
        <div class="panel-heading block-hider toggle-node-form disable-select"><span class="glyphicon glyphicon-menu-up" style="margin-right:5px;"></span> <b>Skjema for redigering av {{#if $eq node.nodeType "chapter"}}kapittelelement{{else}}informasjonselement{{/if}}</b></div>
        <div class="panel-body">
          <p><em>Her kan man redigere verdiene for det valgte {{#if $eq node.nodeType "chapter"}}kapittelelementet{{else}}informasjonselementet{{/if}}. Det valgte elementet er markert i kapittelstrukturen.</em></p>

          {{#autoForm collection="GV.collections.Nodes" id="update-node-form" doc=node type="update"}}
            {{#if $eq node.nodeType "chapter"}}
              {{> afQuickField name="title" placeholder="Kapittelnavn" label="Kapittelnavn"}}
              {{> afQuickField name="description" rows="6" placeholder="Beskrivelse" label="Beskrivelse"}}
            {{else}}
              {{> afQuickField name="title" }}
              {{> afQuickField name="description" rows="6" }}
              {{> afQuickField name="tags" options=getTagsOptions}}
              {{> afQuickField name="references" options=getReferencesOptions}}

              <div class="row" style="margin-bottom:20px;">
                <div class="col-xs-12">
                  <div class="row" style="margin-bottom:20px;">
                    <div class="col-xs-12">
                      {{!-- Upload process status --}}
                      {{#with file}}
                          {{#if this.isUploaded}}
                            <b><a href="#" class="download">{{this.name}}</a></b> er nå lagt som vedlegg til informasjonselementet.
                            <button type="button" class="btn btn-danger btn-xs delete-file">Slett</button>
                          {{else}}

                            Laster opp <b>{{this.name}}</b>...

                            {{> FS.UploadProgressBar bootstrap=true class='progress-bar-success progress-bar-striped active' showPercent=true}}

                            {{#unless uploadStopped}}
                              <button type="button" class="btn btn-info pull-right stop-upload">Stopp opplastning</button>
                            {{else}}
                              <button type="button" class="btn btn-info pull-right resume-upload">Fortsett opplastning</button>
                            {{/unless}}
                          {{/if}}
                      {{/with}}
                    </div>
                  </div>
                  {{!-- Upload field --}}
                  {{#unless file}}
                    <div class="upload-field">
                      <span><span class="glyphicon glyphicon-upload" style="margin-right:5px;"></span> Klikk for å vedlegge fil</span>
                      <input class="file-upload pull-left" type="file">
                    </div>
                  {{else}}
                    {{#if uploadStopped}}
                    <div class="upload-field">
                      <span>Klikk for å bytte fil</span>
                      <input class="file-upload pull-left" type="file">
                    </div>
                    {{/if}}
                  {{/unless}}

                </div>
              </div>
            {{/if}}

            <div class="form-group">
              {{#if $eq node.nodeType "chapter"}}
                <button type="button" class="btn btn-danger pull-left delete-chapter-node"><span class="glyphicon glyphicon-remove"></span> Slett kapittelelement</button>
              {{else}}
                <button type="button" class="btn btn-danger pull-left delete-media-node"><span class="glyphicon glyphicon-remove"></span> Slett informasjonselement</button>
              {{/if}}
              <button type="submit" class="btn btn-primary pull-right {{#if file}}{{#unless uploadStopped}}{{#unless file.isUploaded}}disabled{{/unless}}{{/unless}}{{/if}}">Lagre</button>
              <button type="button" class="btn btn-default pull-right cancel" style="margin-right:10px;">Nullstill</button>
            </div>
          {{/autoForm}}
        </div>
      </div>
    {{else}}
      <div class="well well-sm block-hider toggle-node-form"><span class="glyphicon glyphicon-menu-down" style="margin-right:5px;"></span> <b>Skjema for redigering av {{#if $eq node.nodeType "chapter"}}kapittelelement{{else}}informasjonselement{{/if}}</b></div>
    {{/if}}

  {{#if $eq node.nodeType "chapter"}}
    {{#if $.Session.equals "showMediaNodesView" true}}
      {{> MediaNodesTable class="media-nodes-view" doc=node}}
    {{else}}
      <div class="well well-sm block-hider toggle-media-nodes-view"><span class="glyphicon glyphicon-menu-down" style="margin-right:5px;"></span> <b>Informasjonselementer i dette kapittelelementet</b></div>
    {{/if}}
  {{/if}}

</template>

<!--
Edit top level information about a document. This is basically the root node.
-->
<template name="GeneralInfo">

  {{> MediaNodesTable doc=this}}

	<h3>Redigering av prosjektbeskrivelsen</h3>
  <p><em>Her kan man beskrive dokumentet i sin helhet. Denne informasjonen brukes for å kunne skille mellom de ulike dokumentene.</em></p>

	{{#autoForm collection="GV.collections.Documents" id="update-document-form" doc=this type="update"}}
		{{> afQuickField name="title" }}
		{{> afQuickField name="summary" rows="6" placeholder="Skriv inn en kortfattet beskrivelse av prosjektet" label="Prosjektbeskrivelse"}}

		<div class="form-group">
			<button type="button" class="btn btn-danger pull-left delete-document">Slett hele dokumentet</button>
			<button type="submit" class="btn btn-primary pull-right">Lagre</button>
			<button type="button" class="btn btn-default pull-right cancel" style="margin-right:10px;">Nullstill</button>
		</div>
	{{/autoForm}}
</template>

<template name="MediaNodesTable">
  <div class="panel panel-default nodes-table {{class}}">
    <!-- Default panel contents -->
    <div class="panel-heading block-hider toggle-media-nodes-view"><span class="glyphicon glyphicon-menu-up" style="margin-right:5px;"></span> <b>Informasjonselementer i dette kapittelelementet</b> <button type="button" class="btn btn-success btn-xs pull-right add-media-node"><span class="glyphicon glyphicon-plus"></span> informasjonselement</button></div>
    <div class="panel-body">
      <p><em>Her listes opp alle informasjonselementene som er knyttet dette delkapittelet. Du kan huke av elementer og slette eller flytte dem et annet sted i strukturen.</em></p>
    </div>

    <!-- Table -->
    <table class="table table-striped table-hover table-condensed">
      <thead>
        <tr>
          <th><input type="checkbox" class="checkbox-master" aria-label="..."></th>
          <th>Informasjonselement</th>
          <th>
            <div class="dropup">
              <button class="btn btn-default btn-xs dropdown-toggle" type="button" id="media-nodew-dropdown" data-toggle="dropdown" aria-expanded="true">
                Handling
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="media-nodew-dropdown">
                <li role="presentation"><a role="menuitem" tabindex="-1" href="#"><span class="glyphicon glyphicon-move"></span> Flytt markerte</a></li>
                <li role="presentation"><a role="menuitem" tabindex="-1" href="#"><span class="glyphicon glyphicon-remove"></span> Slett markerte</a></li>
              </ul>
            </div>
          </th>
        </tr>
      </thead>
      <tbody>
        {{#each getChildren}}
          {{> ViewMediaNode}}
        {{else}}
          <tr>
            <td></td>
            <td><em>Ingen informasjonselementer knyttet til det valgte kapittelelementet.</em></td>
            <td></td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  </div>
</template>

<template name="ViewMediaNode">
  <tr class="table-row">
    <td class="row-item" style="width:20px;"><input type="checkbox" class="checkbox" aria-label="..."></td>
    <td class="row-item">
      {{#if description}}{{{convertLineBreaks description}}}{{else}}-{{/if}}
      <hr>
      <ul class="node-list">
        <li class="node-list-item"><b>Kilder:</b> {{commaSeparated references}}</li>
        <li class="node-list-item"><b>Nøkkelord:</b> {{commaSeparated tags}}</li>
        {{#with file}}
          <li class="node-list-item"><b>Fil:</b> <a href="#" class="download">{{this.name}}</a></li>
        {{/with}}
      </ul>
    </td>
    <td class="row-item text-right" style="width:60px;"><button type="button" class="btn btn-success btn-xs edit-media-node"><span class="glyphicon glyphicon-edit"></span> Rediger</button></td>
  </tr>
</template>

<template name="ViewChapterNode">
</template>
