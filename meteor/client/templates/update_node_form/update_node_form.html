<!--
~ Copyright 2015 Concept
~
~ Licensed under the Apache License, Version 2.0 (the "License");
~ you may not use this file except in compliance with the License.
~ You may obtain a copy of the License at
~
~ http://www.apache.org/licenses/LICENSE-2.0
~
~ Unless required by applicable law or agreed to in writing, software
~ distributed under the License is distributed on an "AS IS" BASIS,
~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
~ See the License for the specific language governing permissions and
~ limitations under the License.
-->

<!--
The form for updation a Node
-->
<template name="UpdateNodeForm">
  {{#if showEditWarning}}
    <div class="alert alert-info" role="alert"><b>NB!</b> Du er nå i redigeringsmodus og kan enten lagre eller gå ut av modusen ved bruk av knappene til høyre.</div>
  {{/if}}

  {{#autoForm collection="GV.collections.Nodes" id="update-node-form" doc=node type="update"}}
    {{#if $eq node.nodeType "chapter"}}
      {{> afQuickField name="title" placeholder="Kapittelnavn" label="Kapittelnavn"}}
      {{> afQuickField name="description" rows="6" placeholder="Beskrivelse" label="Beskrivelse"}}
    {{else}}
      {{> afQuickField name="title" }}
      {{> afQuickField name="description" rows="6" }}
      {{> afQuickField name="tags" options=getTagsOptions}}
      {{> afQuickField name="references" options=getReferencesOptions}}

      <div class="row" style="margin-bottom:20px;">
        <div class="col-xs-12">
          <div class="row" style="margin-bottom:20px;">
            <div class="col-xs-12">
              {{!-- Upload process status --}}
              {{#with file}}
                  {{#if this.isUploaded}}
                    <b><a href="#" class="download">{{this.name}}</a></b> er nå lagt som vedlegg til informasjonselementet.
                    <button type="button" class="btn btn-danger btn-xs delete-file">Slett</button>
                  {{else}}

                    Laster opp <b>{{this.name}}</b>...

                    {{> FS.UploadProgressBar bootstrap=true class='progress-bar-success progress-bar-striped active' showPercent=true}}

                    {{#unless uploadStopped}}
                      <button type="button" class="btn btn-info pull-right stop-upload">Stopp opplastning</button>
                    {{else}}
                      <button type="button" class="btn btn-info pull-right resume-upload">Fortsett opplastning</button>
                    {{/unless}}
                  {{/if}}
              {{/with}}
            </div>
          </div>
          {{!-- Upload field --}}
          {{#unless file}}
            <div class="upload-field dropzone">
              <span><span class="glyphicon glyphicon-upload" style="margin-right:5px;"></span> Klikk her eller slipp fil her</span>
              <input class="file-upload pull-left" type="file">
            </div>
          {{else}}
            {{#if uploadStopped}}
            <div class="upload-field">
              <span>Klikk for å bytte fil</span>
              <input class="file-upload pull-left" type="file">
            </div>
            {{/if}}
          {{/unless}}

        </div>
      </div>
    {{/if}}

    {{#unless hideButtons}}
      <div class="form-group">
        {{#if $eq node.nodeType "chapter"}}
          <button type="button" class="btn btn-danger pull-left delete-chapter-node"><span class="glyphicon glyphicon-remove"></span> Slett kapittelelement</button>
        {{else}}
          <button type="button" class="btn btn-danger pull-left delete-media-node"><span class="glyphicon glyphicon-remove"></span> Slett informasjonselement</button>
        {{/if}}
        <button type="submit" class="btn btn-primary pull-right {{#if file}}{{#unless uploadStopped}}{{#unless file.isUploaded}}disabled{{/unless}}{{/unless}}{{/if}}">Lagre</button>
        <button type="button" class="btn btn-default pull-right cancel" style="margin-right:10px;">Nullstill</button>
      </div>
    {{/unless}}
  {{/autoForm}}
</template>
